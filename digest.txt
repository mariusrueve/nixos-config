Directory structure:
└── nixos-config/
    ├── flake.lock
    ├── flake.nix
    ├── home/
    │   └── marius/
    │       └── default.nix
    ├── hosts/
    │   └── gibbon/
    │       ├── default.nix
    │       └── hardware-configuration.nix
    └── modules/
        ├── core/
        │   └── default.nix
        └── desktop/
            └── sway.nix

================================================
File: flake.lock
================================================
{
  "nodes": {
    "home-manager": {
      "inputs": {
        "nixpkgs": [
          "nixpkgs"
        ]
      },
      "locked": {
        "lastModified": 1758463745,
        "narHash": "sha256-uhzsV0Q0I9j2y/rfweWeGif5AWe0MGrgZ/3TjpDYdGA=",
        "owner": "nix-community",
        "repo": "home-manager",
        "rev": "3b955f5f0a942f9f60cdc9cacb7844335d0f21c3",
        "type": "github"
      },
      "original": {
        "owner": "nix-community",
        "ref": "release-25.05",
        "repo": "home-manager",
        "type": "github"
      }
    },
    "nixpkgs": {
      "locked": {
        "lastModified": 1763622513,
        "narHash": "sha256-1jQnuyu82FpiSxowrF/iFK6Toh9BYprfDqfs4BB+19M=",
        "owner": "nixos",
        "repo": "nixpkgs",
        "rev": "c58bc7f5459328e4afac201c5c4feb7c818d604b",
        "type": "github"
      },
      "original": {
        "owner": "nixos",
        "ref": "nixos-25.05",
        "repo": "nixpkgs",
        "type": "github"
      }
    },
    "root": {
      "inputs": {
        "home-manager": "home-manager",
        "nixpkgs": "nixpkgs"
      }
    }
  },
  "root": "root",
  "version": 7
}



================================================
File: flake.nix
================================================
{
  description = "Marius NixOS Configuration";

  inputs = {
    nixpkgs.url = "github:nixos/nixpkgs/nixos-25.05";

    home-manager = {
      url = "github:nix-community/home-manager/release-25.05";
      inputs.nixpkgs.follows = "nixpkgs";
    };
  };

  outputs = { self, nixpkgs, home-manager, ... }@inputs: {
    nixosConfigurations = {
      # Host: Gibbon (Mini PC)
      gibbon = nixpkgs.lib.nixosSystem {
        system = "x86_64-linux";
        specialArgs = { inherit inputs; };
        modules = [
          ./hosts/gibbon
          ./modules/core
          ./modules/desktop/sway.nix

          home-manager.nixosModules.home-manager
          {
            home-manager.useGlobalPkgs = true;
            home-manager.useUserPackages = true;
            home-manager.users.marius = import ./home/marius;
          }
        ];
      };
      
      # Future hosts (gorilla/orangutan) would be added here
    };
  };
}



================================================
File: home/marius/default.nix
================================================
{ pkgs, lib, ... }:

{
  home.username = "marius";
  home.homeDirectory = "/home/marius";

  # Firefox configuration
  programs.firefox.enable = true;

  wayland.windowManager.sway = {
    enable = true;
    checkConfig = false; # sometimes helpful to disable check if it false-flags on VM/headless
    
    config = {
      modifier = "Mod4"; # Sets the "Windows" key as your main modifier
      terminal = "alacritty"; 
      
      output = {
        "DP-3" = {
          # The mode matches your specific Iiyama ultrawide specs
          mode = "3440x1440@60Hz";
          pos = "0 0";
          scale = "1.25";
          # Set a solid background color for now so you don't see a black void
          bg = "#282c34 solid_color"; 
        };
      };
    };
  };

  # Add User-specific packages here
  home.packages = with pkgs; [
    thunderbird
    # discord
    spotify
    vscode
    gh
    alacritty
    lazygit
    codex
    gemini-cli
  ];

  # Basic Git config
  programs.git = {
    enable = true;
    
    # 1. Identity goes here directly
    userName = "Marius";
    # userEmail = "marius@example.com"; # You likely want to add this!

    # 2. "init.defaultBranch" and other settings go into extraConfig
    extraConfig = {
      init = {
        defaultBranch = "main";
      };
      # You can add other git config items here, e.g.:
      # pull.rebase = true;
    };
  };

  home.sessionVariables = {
    # Fix for Electron apps on Wayland
    NIXOS_OZONE_WL = "1"; 
  };

  # This version allows Home Manager to be backwards compatible
  home.stateVersion = "25.05";
}



================================================
File: hosts/gibbon/default.nix
================================================
{ pkgs, ... }:

{
  imports = [
    ./hardware-configuration.nix
  ];

  networking.hostName = "gibbon";

  # You can add specific gibbon-only overrides here
  # e.g., if gibbon needs specific bluetooth drivers or power settings
}



================================================
File: hosts/gibbon/hardware-configuration.nix
================================================
# Do not modify this file!  It was generated by ‘nixos-generate-config’
# and may be overwritten by future invocations.  Please make changes
# to /etc/nixos/configuration.nix instead.
{ config, lib, pkgs, modulesPath, ... }:

{
  imports =
    [ (modulesPath + "/installer/scan/not-detected.nix")
    ];

  boot.initrd.availableKernelModules = [ "nvme" "xhci_pci" "usbhid" "usb_storage" "sd_mod" ];
  boot.initrd.kernelModules = [ ];
  boot.kernelModules = [ "kvm-amd" ];
  boot.extraModulePackages = [ ];

  fileSystems."/" =
    { device = "/dev/disk/by-uuid/39328ccd-3de1-45f1-927f-4bddd36f14b9";
      fsType = "ext4";
    };

  fileSystems."/boot" =
    { device = "/dev/disk/by-uuid/5865-783C";
      fsType = "vfat";
      options = [ "fmask=0077" "dmask=0077" ];
    };

  swapDevices =
    [ { device = "/dev/disk/by-uuid/15982f7d-d29e-4972-b5ef-9b2ca5019398"; }
    ];

  # Enables DHCP on each ethernet and wireless interface. In case of scripted networking
  # (the default) this is the recommended approach. When using systemd-networkd it's
  # still possible to use this option, but it's recommended to use it in conjunction
  # with explicit per-interface declarations with `networking.interfaces.<interface>.useDHCP`.
  networking.useDHCP = lib.mkDefault true;
  # networking.interfaces.enp1s0.useDHCP = lib.mkDefault true;
  # networking.interfaces.enp4s0f4u1u4.useDHCP = lib.mkDefault true;
  # networking.interfaces.wlo1.useDHCP = lib.mkDefault true;

  nixpkgs.hostPlatform = lib.mkDefault "x86_64-linux";
  hardware.cpu.amd.updateMicrocode = lib.mkDefault config.hardware.enableRedistributableFirmware;
}



================================================
File: modules/core/default.nix
================================================
{ pkgs, ... }:

{
  # Bootloader
  boot.loader.systemd-boot.enable = true;
  boot.loader.efi.canTouchEfiVariables = true;

  # Kernel: Using latest unstable kernel as requested
  boot.kernelPackages = pkgs.linuxPackages_latest;

  # Networking
  networking.networkmanager.enable = true;

  # Timezone and Locales
  time.timeZone = "Europe/Berlin";
  i18n.defaultLocale = "en_US.UTF-8";
  i18n.extraLocaleSettings = {
    LC_ADDRESS = "en_IE.UTF-8";
    LC_IDENTIFICATION = "en_IE.UTF-8";
    LC_MEASUREMENT = "en_IE.UTF-8";
    LC_MONETARY = "en_IE.UTF-8";
    LC_NAME = "en_IE.UTF-8";
    LC_NUMERIC = "en_IE.UTF-8";
    LC_PAPER = "en_IE.UTF-8";
    LC_TELEPHONE = "en_IE.UTF-8";
    LC_TIME = "en_IE.UTF-8";
  };

  # Audio (Pipewire)
  security.rtkit.enable = true;
  services.pipewire = {
    enable = true;
    alsa.enable = true;
    alsa.support32Bit = true;
    pulse.enable = true;
  };

  # User Account
  users.users.marius = {
    isNormalUser = true;
    description = "Marius";
    extraGroups = [ "networkmanager" "wheel" ];
    # shell = pkgs.zsh; # Optional: if you want to switch shell later
  };

  # System Packages (Common to all hosts)
  environment.systemPackages = with pkgs; [
    vim
    git
    wget
    curl
    gitingest
  ];

  # Nix Settings
  nix.settings.experimental-features = [ "nix-command" "flakes" ];
  nixpkgs.config.allowUnfree = true;
  
  # Printing (Kept from your old config, useful to have in base)
  services.printing.enable = true;

  system.stateVersion = "25.05";
}



================================================
File: modules/desktop/sway.nix
================================================
{ pkgs, ... }:

{
  # Enable Sway Window Manager
  programs.sway = {
    enable = true;
    wrapperFeatures.gtk = true;
  };

  # Display Manager: Ly
  services.displayManager.ly.enable = true;

  # Necessary for Wayland to work correctly (screensharing, etc)
  xdg.portal = {
    enable = true;
    wlr.enable = true;
    extraPortals = [ pkgs.xdg-desktop-portal-gtk ];
  };

  # Security for Wayland (polkit)
  security.polkit.enable = true;

  # Common Sway packages
  environment.systemPackages = with pkgs; [
    wl-clipboard   # Clipboard manager
    mako           # Notification daemon
    wofi           # App launcher (alternative to dmenu/rofi)
    waybar         # Status bar
    grim           # Screenshots
    slurp          # Area selection for screenshots
  ];
}


